# Web Serial Debug - 测试指南

## 快速开始

### 1. 启动项目
```bash
cd vue/web_serial
npm run dev
```

访问: http://localhost:5173

### 2. 浏览器要求
- ✅ Chrome 89+
- ✅ Edge 89+
- ❌ Firefox（不支持 Web Serial API）
- ❌ Safari（不支持 Web Serial API）

### 3. 准备测试设备
- USB 转串口设备（如 CH340、CP2102、FT232 等）
- 或支持串口的开发板（如 Arduino、ESP32 等）

## 功能测试清单

### 一、基础串口功能

#### 1.1 串口选择和连接
- [ ] 点击"选择串口"按钮
- [ ] 浏览器弹出串口选择对话框
- [ ] 选择一个串口设备
- [ ] 状态显示变为"设备已连接"
- [ ] 点击"打开串口"按钮
- [ ] 按钮文字变为"关闭串口"
- [ ] 状态保持"设备已连接"

#### 1.2 串口配置
- [ ] 修改波特率（如改为 9600）
- [ ] 串口自动重启（关闭后重新打开）
- [ ] 修改数据位、停止位、校验位
- [ ] 每次修改都会触发串口重启
- [ ] 配置保存到 localStorage

#### 1.3 串口断开重连
- [ ] 拔掉 USB 设备
- [ ] 状态显示"设备已断开"
- [ ] 重新插入 USB 设备
- [ ] 自动重连（如果之前是打开状态）
- [ ] 状态恢复为"设备已连接"

### 二、数据接收功能

#### 2.1 基础接收
- [ ] 打开串口
- [ ] 从设备发送数据
- [ ] 日志区域显示接收到的数据
- [ ] 时间戳正确显示
- [ ] 方向标识为 "←"（接收）

#### 2.2 日志类型切换
- [ ] 切换到"Hex"模式
  - [ ] 只显示十六进制数据
  - [ ] 格式: `01 02 03 04`
- [ ] 切换到"Text"模式
  - [ ] 只显示文本数据
  - [ ] 特殊字符正确转义
- [ ] 切换到"Hex和Text"模式
  - [ ] 同时显示 HEX 和 TEXT
  - [ ] 格式正确
- [ ] 切换到"彩色Ansi"模式
  - [ ] 背景变黑色
  - [ ] ANSI 转义序列正确渲染
  - [ ] 颜色正确显示

#### 2.3 分包合并
- [ ] 设置分包超时为 50ms
- [ ] 快速发送多个数据包
- [ ] 50ms 内的数据合并为一条日志
- [ ] 设置分包超时为 0
- [ ] 每个数据包单独显示

#### 2.4 自动滚动
- [ ] 点击"自动滚动"按钮
- [ ] 接收数据时自动滚动到底部
- [ ] 点击"暂停滚动"
- [ ] 接收数据时不滚动
- [ ] 手动滚动位置保持

### 三、数据发送功能

#### 3.1 基础发送
- [ ] 在发送框输入文本: `Hello World`
- [ ] 点击"发送"按钮
- [ ] 日志显示发送的数据
- [ ] 方向标识为 "→"（发送）
- [ ] 设备收到数据

#### 3.2 HEX 发送
- [ ] 勾选"HEX发送"
- [ ] 输入: `48656C6C6F`（Hello 的 HEX）
- [ ] 点击发送
- [ ] 设备收到正确的字节数据
- [ ] 输入错误的 HEX（如 `48656C6C6`）
- [ ] 提示"HEX格式错误"

#### 3.3 末尾加回车换行
- [ ] 勾选"末尾加回车换行"
- [ ] 输入: `AT`
- [ ] 点击发送
- [ ] 实际发送: `AT\r\n`
- [ ] 设备收到带回车换行的数据

#### 3.4 循环发送
- [ ] 勾选"循环发送"
- [ ] 设置间隔为 1000ms
- [ ] 输入: `test`
- [ ] 点击发送
- [ ] 每秒自动发送一次
- [ ] 取消勾选停止循环

### 四、快捷发送功能

#### 4.1 默认分组
- [ ] 打开"快捷发送"标签
- [ ] 看到"ESP32 AT指令"分组
- [ ] 包含多个 AT 命令
- [ ] 点击"测试 AT 启动"按钮
- [ ] 发送 `AT` 命令

#### 4.2 添加快捷项
- [ ] 点击"增加一条"
- [ ] 新增一个空白项
- [ ] 输入发送内容: `Hello`
- [ ] 双击显示名称按钮
- [ ] 输入新名称: `问候`
- [ ] 点击"问候"按钮发送

#### 4.3 分组管理
- [ ] 点击"新增"按钮
- [ ] 输入分组名: `测试分组`
- [ ] 新分组出现在下拉框
- [ ] 点击"改名"
- [ ] 修改分组名
- [ ] 点击"删除"
- [ ] 确认删除分组

#### 4.4 导入导出
- [ ] 添加几个快捷项
- [ ] 点击"导出"
- [ ] 下载 JSON 文件
- [ ] 删除所有快捷项
- [ ] 点击"导入"
- [ ] 选择刚才的 JSON 文件
- [ ] 快捷项恢复

### 五、系统选项功能

#### 5.1 导出配置
- [ ] 打开"系统选项"标签
- [ ] 点击"导出配置"
- [ ] 下载配置文件
- [ ] 文件包含所有配置

#### 5.2 导入配置
- [ ] 修改一些配置
- [ ] 点击"导入配置"
- [ ] 选择之前导出的文件
- [ ] 配置恢复到导出时的状态
- [ ] 页面自动刷新

#### 5.3 重置参数
- [ ] 点击"重置参数"
- [ ] 确认重置
- [ ] 所有配置恢复默认值
- [ ] localStorage 被清空
- [ ] 页面自动刷新

### 六、代码脚本功能

#### 6.1 基础运行
- [ ] 打开"代码脚本"标签
- [ ] 看到示例代码
- [ ] 点击"运行"
- [ ] 按钮变为"停止"
- [ ] 脚本开始执行

#### 6.2 数据接收处理
- [ ] 使用示例代码（回显）
- [ ] 点击运行
- [ ] 发送数据到设备
- [ ] 脚本接收到数据
- [ ] 自动回复相同数据
- [ ] 日志显示"收到数据长度:X"

#### 6.3 定时发送
```javascript
setInterval(function(){
  postMessage({type:'uart_send_txt', data:'hello'});
}, 1000);
```
- [ ] 输入上述代码
- [ ] 点击运行
- [ ] 每秒自动发送 `hello`
- [ ] 点击停止
- [ ] 停止发送

#### 6.4 文件操作
- [ ] 编写一段脚本
- [ ] 点击"保存文件"
- [ ] 下载 .js 文件
- [ ] 清空编辑器
- [ ] 点击"打开文件"
- [ ] 选择刚才的文件
- [ ] 脚本内容恢复

### 七、界面功能

#### 7.1 侧边栏折叠
- [ ] 点击左侧折叠按钮
- [ ] 左侧配置面板隐藏
- [ ] 图标方向改变
- [ ] 再次点击展开
- [ ] 右侧工具栏同样测试

#### 7.2 头部隐藏
- [ ] 点击"隐藏头部"链接
- [ ] 头部导航消失
- [ ] 主内容区域高度增加
- [ ] 刷新页面
- [ ] 头部重新显示

#### 7.3 日志操作
- [ ] 接收一些数据
- [ ] 点击"清空"
- [ ] 日志清空
- [ ] 再接收一些数据
- [ ] 点击"复制"
- [ ] 粘贴到文本编辑器
- [ ] 内容正确
- [ ] 点击"导出"
- [ ] 下载日志文件

### 八、配置持久化

#### 8.1 串口配置
- [ ] 修改波特率为 9600
- [ ] 刷新页面
- [ ] 波特率保持 9600

#### 8.2 发送配置
- [ ] 勾选"HEX发送"
- [ ] 勾选"循环发送"
- [ ] 输入发送内容
- [ ] 刷新页面
- [ ] 所有配置保持

#### 8.3 快捷发送
- [ ] 添加快捷项
- [ ] 创建新分组
- [ ] 刷新页面
- [ ] 快捷项和分组保持

#### 8.4 代码脚本
- [ ] 编写脚本
- [ ] 刷新页面
- [ ] 脚本内容保持

## 性能测试

### 1. 大量数据接收
- [ ] 设备连续发送数据
- [ ] 观察日志显示是否流畅
- [ ] CPU 使用率是否正常
- [ ] 内存是否持续增长

### 2. 长时间运行
- [ ] 开启循环发送
- [ ] 运行 10 分钟
- [ ] 观察是否有内存泄漏
- [ ] 功能是否正常

### 3. 快速切换
- [ ] 快速切换日志类型
- [ ] 快速开关串口
- [ ] 快速切换分组
- [ ] 观察是否有错误

## 兼容性测试

### Chrome
- [ ] 版本 89+
- [ ] 所有功能正常
- [ ] 性能良好

### Edge
- [ ] 版本 89+
- [ ] 所有功能正常
- [ ] 性能良好

## 错误处理测试

### 1. 串口错误
- [ ] 未选择串口时点击打开
- [ ] 提示"请先选择串口"
- [ ] 串口被占用时打开
- [ ] 显示错误信息

### 2. 发送错误
- [ ] 串口未打开时发送
- [ ] 提示"请先打开串口"
- [ ] HEX 格式错误
- [ ] 提示"HEX格式错误"

### 3. 文件操作错误
- [ ] 导入错误格式的文件
- [ ] 提示"文件格式错误"
- [ ] 导入空文件
- [ ] 正确处理

## 测试报告模板

```markdown
## 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: 
**浏览器**: Chrome/Edge 版本号
**操作系统**: Windows/Mac/Linux

### 测试结果

| 功能模块 | 测试项 | 结果 | 备注 |
|---------|--------|------|------|
| 串口连接 | 选择串口 | ✅/❌ | |
| 串口连接 | 打开串口 | ✅/❌ | |
| 数据接收 | Hex 显示 | ✅/❌ | |
| 数据接收 | Text 显示 | ✅/❌ | |
| 数据接收 | ANSI 显示 | ✅/❌ | |
| 数据发送 | 普通发送 | ✅/❌ | |
| 数据发送 | HEX 发送 | ✅/❌ | |
| 快捷发送 | 添加项目 | ✅/❌ | |
| 快捷发送 | 分组管理 | ✅/❌ | |
| 代码脚本 | 运行脚本 | ✅/❌ | |
| 系统选项 | 导入导出 | ✅/❌ | |

### 发现的问题

1. 
2. 
3. 

### 建议

1. 
2. 
3. 
```

## 常见问题

### Q: 浏览器提示不支持串口操作
**A**: 请使用 Chrome 89+ 或 Edge 89+ 浏览器

### Q: 选择串口后无法打开
**A**: 
1. 检查串口是否被其他程序占用
2. 检查串口驱动是否正常
3. 尝试重新插拔设备

### Q: ANSI 颜色显示不正确
**A**: 
1. 确认设备发送的是标准 ANSI 转义序列
2. 切换到"彩色Ansi"模式
3. 检查浏览器控制台是否有错误

### Q: 循环发送无法停止
**A**: 
1. 取消勾选"循环发送"
2. 如果无效，刷新页面

### Q: 配置丢失
**A**: 
1. 检查浏览器是否清除了 localStorage
2. 导出配置文件作为备份
3. 使用导入功能恢复

## 测试完成标准

- ✅ 所有基础功能测试通过
- ✅ 所有高级功能测试通过
- ✅ 性能测试通过
- ✅ 兼容性测试通过
- ✅ 错误处理测试通过
- ✅ 无严重 Bug
- ✅ 用户体验良好

祝测试顺利！🎉

